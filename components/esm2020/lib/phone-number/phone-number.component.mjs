import { Component, EventEmitter, Input, Output } from '@angular/core';
import { FormControl, FormGroup, Validators } from '@angular/forms';
import { Subject } from 'rxjs';
import { countriesCode } from './data/countries-codes';
import { Country } from './model/country.model';
import * as i0 from "@angular/core";
import * as i1 from "./service/phone-validation.service";
import * as i2 from "@angular/common";
import * as i3 from "../custom-select/custom-select.component";
import * as i4 from "@angular/forms";
import * as i5 from "../input-validation/input-validation.directive";
import * as i6 from "../loading-button/loading-button.directive";
import * as i7 from "../spinner/spinner.component";
export class PhoneNumberComponent {
    constructor(phoneValidationService) {
        this.phoneValidationService = phoneValidationService;
        this.labelPhoneNumberValidation = 'Phone number is invalid';
        this.phoneValidated = false;
        this.phoneAvailable = false;
        this.isLoading = false;
        this.validationPhoneEvent = new EventEmitter();
        this.isValidPhoneNumber = () => {
            return (control) => {
                this.getCountryByPhoneNumber(control.value);
                const validation = this.phoneValidationService.validateAndFormat(control.value, this.selectedOption.code, this.selectedOption.dial_code);
                if (validation.masked === control.value)
                    return null;
                this.labelPhoneNumberValidation = 'Phone number is invalid';
                this.phoneValidated = false;
                this.validationPhoneEvent.emit(false);
                if (this.verifiedPhoneNumber.length && control.value === this.verifiedPhoneNumber.replace(/\s|-/gi, '')) {
                    this.validationPhoneEvent.emit(true);
                    this.phoneValidated = true;
                    return null;
                }
                if (validation.isValid) {
                    control.setValue(validation.masked || control.value);
                    return null;
                }
                return { isInvalidPhoneNumber: true };
            };
        };
        this.options = [];
        this.selectedOption = new Country();
        this.verifiedPhoneNumber = '';
        this.formGroup = new FormGroup({
            phoneNumber: new FormControl('', [Validators.required, this.isValidPhoneNumber()])
        });
        this.destroy$ = new Subject();
    }
    ngOnInit() {
        this.options = countriesCode.map(country => new Country(country.name, country.dial_code, country.code, country.latitude, country.longitude));
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.unsubscribe();
    }
    getSelectedCountry(country) {
        this.selectedOption = new Country(country.name, country.dial_code, country.code, country.latitude, country.longitude);
        this.formGroup.patchValue({
            phoneNumber: country.dial_code,
        });
    }
    getCountryByPhoneNumber(phoneNumber) {
        const countries = this.phoneValidationService.filterCountryCode(phoneNumber);
        if (countries.length)
            this.checkIfHasEqualsDialCode(countries);
    }
    checkIfHasEqualsDialCode(countries) {
        const hasEqualsDialCode = countries.find(country => country.dial_code === this.selectedOption.dial_code && country.name === this.selectedOption.name);
        if (!hasEqualsDialCode)
            this.selectedOption = new Country(countries[0].name, countries[0].dial_code, countries[0].code, countries[0].latitude, countries[0].longitude);
    }
    get phoneNumber() {
        return this.formGroup.controls.phoneNumber;
    }
}
PhoneNumberComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.1.2", ngImport: i0, type: PhoneNumberComponent, deps: [{ token: i1.PhoneValidationService }], target: i0.ɵɵFactoryTarget.Component });
PhoneNumberComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.1.2", type: PhoneNumberComponent, selector: "cdk-phone-number", inputs: { labelPhoneNumberValidation: "labelPhoneNumberValidation", phoneValidated: "phoneValidated", phoneAvailable: "phoneAvailable", isLoading: "isLoading" }, outputs: { validationPhoneEvent: "validationPhoneEvent" }, ngImport: i0, template: "<form [formGroup]=\"formGroup\" class=\"d-flex flex-column\">\r\n  <div class=\"d-flex justify-content-between\">\r\n    <div class=\"row-form mt-0 flex-grow-0\">\r\n      <cdk-custom-select\r\n        placeholder=\"\"\r\n        modelProperty=\"dial_code\"\r\n        label=\"code\"\r\n        [options]=\"options\"\r\n        [selectedOption]=\"selectedOption\"\r\n        [isValid]=\"phoneNumber && phoneNumber.touched && !phoneNumber.errors\"\r\n        (valueChanges)=\"getSelectedCountry($event)\"\r\n        [hasLeftIcon]=\"true\"\r\n        [hasDivider]=\"true\"\r\n        class=\"me-3 d-block\"\r\n      >\r\n        <ng-template #customTemplate let-item let-index let-_index=\"index\">\r\n          <span>\r\n            <i class=\"me-2 flag-icon flag-icon-{{ item?.flag }}\"></i>\r\n            ({{ item?.dial_code }}) {{ item?.name }}\r\n          </span>\r\n\r\n          <span aria-hidden=\"true\" *ngIf=\"_index === 1\" class=\"divider\"></span>\r\n        </ng-template>\r\n\r\n        <ng-template #selectedTemplate let-item>\r\n          <i class=\"me-2 flag-icon flag-icon-{{ item?.flag }}\"></i>\r\n        </ng-template>\r\n      </cdk-custom-select>\r\n    </div>\r\n\r\n    <div class=\"row-form position-relative flex-grow-1 w-100\">\r\n      <input\r\n        type=\"text\"\r\n        id=\"phoneNumber\"\r\n        formControlName=\"phoneNumber\"\r\n        cdkInputValidation\r\n        [class.validated]=\"phoneValidated\"\r\n      />\r\n      <label for=\"phoneNumber\">Phone number</label>\r\n\r\n      <small *ngIf=\"phoneNumber && phoneNumber.touched && phoneNumber.errors\">\r\n        <span *ngIf=\"phoneNumber && phoneNumber.errors['required']\">Phone number is required</span>\r\n        <span *ngIf=\"phoneNumber && phoneNumber.value.length && phoneNumber.errors['isInvalidPhoneNumber']\">{{ labelPhoneNumberValidation }}</span>\r\n      </small>\r\n\r\n      <span class=\"validation-icon\">\r\n        <i class=\"bi bi-check2 check\" *ngIf=\"phoneValidated && phoneAvailable\"></i>\r\n        <i class=\"bi bi-x-lg error\" *ngIf=\"phoneValidated && !phoneAvailable\"></i>\r\n      </span>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"d-flex justify-content-end mt-3\">\r\n    <button type=\"submit\" class=\"btn btn-dark\" [disabled]=\"!phoneNumber.value.length || phoneNumber.errors\" [cdkLoadingButton]=\"isLoading\" *ngIf=\"!phoneValidated || !phoneAvailable\">\r\n      <cdk-spinner>Verify Phone</cdk-spinner>\r\n    </button>\r\n    <button type=\"button\" class=\"btn btn-outline-success\" disabled *ngIf=\"phoneValidated && phoneAvailable\">Phone Verified</button>\r\n  </div>\r\n\r\n</form>\r\n", styles: ["form{width:100%;max-width:500px}form cdk-custom-select{width:90px}form input.validated{padding-right:30px}form .validation-icon{position:absolute;top:11px;right:3px}form .validation-icon .check{color:var(--st-green)}form .validation-icon .error{color:var(--st-red)}\n"], dependencies: [{ kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i3.CustomSelectComponent, selector: "cdk-custom-select", inputs: ["options", "placeholder", "modelProperty", "label", "selectedOption", "isValid", "hasLeftIcon", "hasDivider"], outputs: ["valueChanges"] }, { kind: "directive", type: i4.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i4.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i4.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i4.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i4.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i4.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }, { kind: "directive", type: i5.InputValidationDirective, selector: "[cdkInputValidation]" }, { kind: "directive", type: i6.LoadingButtonDirective, selector: "[cdkLoadingButton]", inputs: ["cdkLoadingButton"] }, { kind: "component", type: i7.SpinnerComponent, selector: "cdk-spinner" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.1.2", ngImport: i0, type: PhoneNumberComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cdk-phone-number', template: "<form [formGroup]=\"formGroup\" class=\"d-flex flex-column\">\r\n  <div class=\"d-flex justify-content-between\">\r\n    <div class=\"row-form mt-0 flex-grow-0\">\r\n      <cdk-custom-select\r\n        placeholder=\"\"\r\n        modelProperty=\"dial_code\"\r\n        label=\"code\"\r\n        [options]=\"options\"\r\n        [selectedOption]=\"selectedOption\"\r\n        [isValid]=\"phoneNumber && phoneNumber.touched && !phoneNumber.errors\"\r\n        (valueChanges)=\"getSelectedCountry($event)\"\r\n        [hasLeftIcon]=\"true\"\r\n        [hasDivider]=\"true\"\r\n        class=\"me-3 d-block\"\r\n      >\r\n        <ng-template #customTemplate let-item let-index let-_index=\"index\">\r\n          <span>\r\n            <i class=\"me-2 flag-icon flag-icon-{{ item?.flag }}\"></i>\r\n            ({{ item?.dial_code }}) {{ item?.name }}\r\n          </span>\r\n\r\n          <span aria-hidden=\"true\" *ngIf=\"_index === 1\" class=\"divider\"></span>\r\n        </ng-template>\r\n\r\n        <ng-template #selectedTemplate let-item>\r\n          <i class=\"me-2 flag-icon flag-icon-{{ item?.flag }}\"></i>\r\n        </ng-template>\r\n      </cdk-custom-select>\r\n    </div>\r\n\r\n    <div class=\"row-form position-relative flex-grow-1 w-100\">\r\n      <input\r\n        type=\"text\"\r\n        id=\"phoneNumber\"\r\n        formControlName=\"phoneNumber\"\r\n        cdkInputValidation\r\n        [class.validated]=\"phoneValidated\"\r\n      />\r\n      <label for=\"phoneNumber\">Phone number</label>\r\n\r\n      <small *ngIf=\"phoneNumber && phoneNumber.touched && phoneNumber.errors\">\r\n        <span *ngIf=\"phoneNumber && phoneNumber.errors['required']\">Phone number is required</span>\r\n        <span *ngIf=\"phoneNumber && phoneNumber.value.length && phoneNumber.errors['isInvalidPhoneNumber']\">{{ labelPhoneNumberValidation }}</span>\r\n      </small>\r\n\r\n      <span class=\"validation-icon\">\r\n        <i class=\"bi bi-check2 check\" *ngIf=\"phoneValidated && phoneAvailable\"></i>\r\n        <i class=\"bi bi-x-lg error\" *ngIf=\"phoneValidated && !phoneAvailable\"></i>\r\n      </span>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"d-flex justify-content-end mt-3\">\r\n    <button type=\"submit\" class=\"btn btn-dark\" [disabled]=\"!phoneNumber.value.length || phoneNumber.errors\" [cdkLoadingButton]=\"isLoading\" *ngIf=\"!phoneValidated || !phoneAvailable\">\r\n      <cdk-spinner>Verify Phone</cdk-spinner>\r\n    </button>\r\n    <button type=\"button\" class=\"btn btn-outline-success\" disabled *ngIf=\"phoneValidated && phoneAvailable\">Phone Verified</button>\r\n  </div>\r\n\r\n</form>\r\n", styles: ["form{width:100%;max-width:500px}form cdk-custom-select{width:90px}form input.validated{padding-right:30px}form .validation-icon{position:absolute;top:11px;right:3px}form .validation-icon .check{color:var(--st-green)}form .validation-icon .error{color:var(--st-red)}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.PhoneValidationService }]; }, propDecorators: { labelPhoneNumberValidation: [{
                type: Input
            }], phoneValidated: [{
                type: Input
            }], phoneAvailable: [{
                type: Input
            }], isLoading: [{
                type: Input
            }], validationPhoneEvent: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGhvbmUtbnVtYmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2NvbXBvbmVudHMvc3JjL2xpYi9waG9uZS1udW1iZXIvcGhvbmUtbnVtYmVyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2NvbXBvbmVudHMvc3JjL2xpYi9waG9uZS1udW1iZXIvcGhvbmUtbnVtYmVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzFGLE9BQU8sRUFBbUIsV0FBVyxFQUFFLFNBQVMsRUFBaUMsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDcEgsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUMvQixPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFFdkQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHVCQUF1QixDQUFDOzs7Ozs7Ozs7QUFRaEQsTUFBTSxPQUFPLG9CQUFvQjtJQXdDL0IsWUFDVSxzQkFBOEM7UUFBOUMsMkJBQXNCLEdBQXRCLHNCQUFzQixDQUF3QjtRQXZDL0MsK0JBQTBCLEdBQUcseUJBQXlCLENBQUM7UUFDdkQsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFDdkIsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFDdkIsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNqQix5QkFBb0IsR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO1FBRTdELHVCQUFrQixHQUFHLEdBQWdCLEVBQUU7WUFDckMsT0FBTyxDQUFDLE9BQXdCLEVBQTJCLEVBQUU7Z0JBQzNELElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQzVDLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQ3pJLElBQUksVUFBVSxDQUFDLE1BQU0sS0FBSyxPQUFPLENBQUMsS0FBSztvQkFBRSxPQUFPLElBQUksQ0FBQztnQkFDckQsSUFBSSxDQUFDLDBCQUEwQixHQUFHLHlCQUF5QixDQUFDO2dCQUM1RCxJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQztnQkFDNUIsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFFdEMsSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsTUFBTSxJQUFJLE9BQU8sQ0FBQyxLQUFLLEtBQUssSUFBSSxDQUFDLG1CQUFtQixDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLEVBQUU7b0JBQ3ZHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ3JDLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDO29CQUMzQixPQUFPLElBQUksQ0FBQztpQkFDYjtnQkFFRCxJQUFJLFVBQVUsQ0FBQyxPQUFPLEVBQUU7b0JBQ3RCLE9BQU8sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLE1BQU0sSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQ3JELE9BQU8sSUFBSSxDQUFDO2lCQUNiO2dCQUVELE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxJQUFJLEVBQUUsQ0FBQztZQUN4QyxDQUFDLENBQUE7UUFDSCxDQUFDLENBQUE7UUFFRCxZQUFPLEdBQWUsRUFBRSxDQUFDO1FBQ3pCLG1CQUFjLEdBQUcsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUMvQix3QkFBbUIsR0FBRyxFQUFFLENBQUM7UUFDekIsY0FBUyxHQUFHLElBQUksU0FBUyxDQUFDO1lBQ3hCLFdBQVcsRUFBRSxJQUFJLFdBQVcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxVQUFVLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLENBQUM7U0FDbkYsQ0FBQyxDQUFDO1FBQ0ssYUFBUSxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7SUFJcEMsQ0FBQztJQUVKLFFBQVE7UUFDTixJQUFJLENBQUMsT0FBTyxHQUFHLGFBQWEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBQy9JLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQzlCLENBQUM7SUFFRCxrQkFBa0IsQ0FBQyxPQUFpQjtRQUNsQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3RILElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDO1lBQ3hCLFdBQVcsRUFBRSxPQUFPLENBQUMsU0FBUztTQUMvQixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsdUJBQXVCLENBQUMsV0FBbUI7UUFDekMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzdFLElBQUcsU0FBUyxDQUFDLE1BQU07WUFBRSxJQUFJLENBQUMsd0JBQXdCLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDaEUsQ0FBQztJQUVELHdCQUF3QixDQUFDLFNBQXFCO1FBQzVDLE1BQU0saUJBQWlCLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxTQUFTLEtBQUssSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLElBQUksT0FBTyxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RKLElBQUksQ0FBQyxpQkFBaUI7WUFDdEIsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNqSixDQUFDO0lBRUQsSUFBSSxXQUFXO1FBQ2IsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUM7SUFDN0MsQ0FBQzs7aUhBekVVLG9CQUFvQjtxR0FBcEIsb0JBQW9CLHFSQ2JqQyxzbEZBNERBOzJGRC9DYSxvQkFBb0I7a0JBTGhDLFNBQVM7K0JBQ0Usa0JBQWtCOzZHQU1uQiwwQkFBMEI7c0JBQWxDLEtBQUs7Z0JBQ0csY0FBYztzQkFBdEIsS0FBSztnQkFDRyxjQUFjO3NCQUF0QixLQUFLO2dCQUNHLFNBQVM7c0JBQWpCLEtBQUs7Z0JBQ0ksb0JBQW9CO3NCQUE3QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIElucHV0LCBPbkRlc3Ryb3ksIE9uSW5pdCwgT3V0cHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgRm9ybUNvbnRyb2wsIEZvcm1Hcm91cCwgVmFsaWRhdGlvbkVycm9ycywgVmFsaWRhdG9yRm4sIFZhbGlkYXRvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgY291bnRyaWVzQ29kZSB9IGZyb20gJy4vZGF0YS9jb3VudHJpZXMtY29kZXMnO1xyXG5pbXBvcnQgeyBJQ291bnRyeSB9IGZyb20gJy4vbW9kZWwvY291bnRyeS5pbnRlcmZhY2UnO1xyXG5pbXBvcnQgeyBDb3VudHJ5IH0gZnJvbSAnLi9tb2RlbC9jb3VudHJ5Lm1vZGVsJztcclxuaW1wb3J0IHsgUGhvbmVWYWxpZGF0aW9uU2VydmljZSB9IGZyb20gJy4vc2VydmljZS9waG9uZS12YWxpZGF0aW9uLnNlcnZpY2UnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdjZGstcGhvbmUtbnVtYmVyJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vcGhvbmUtbnVtYmVyLmNvbXBvbmVudC5odG1sJyxcclxuICBzdHlsZVVybHM6IFsnLi9waG9uZS1udW1iZXIuY29tcG9uZW50LnNjc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgUGhvbmVOdW1iZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XHJcblxyXG4gIEBJbnB1dCgpIGxhYmVsUGhvbmVOdW1iZXJWYWxpZGF0aW9uID0gJ1Bob25lIG51bWJlciBpcyBpbnZhbGlkJztcclxuICBASW5wdXQoKSBwaG9uZVZhbGlkYXRlZCA9IGZhbHNlO1xyXG4gIEBJbnB1dCgpIHBob25lQXZhaWxhYmxlID0gZmFsc2U7XHJcbiAgQElucHV0KCkgaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgQE91dHB1dCgpIHZhbGlkYXRpb25QaG9uZUV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPigpO1xyXG5cclxuICBpc1ZhbGlkUGhvbmVOdW1iZXIgPSAoKTogVmFsaWRhdG9yRm4gPT4ge1xyXG4gICAgcmV0dXJuIChjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzIHwgbnVsbCA9PiB7XHJcbiAgICAgIHRoaXMuZ2V0Q291bnRyeUJ5UGhvbmVOdW1iZXIoY29udHJvbC52YWx1ZSk7XHJcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB0aGlzLnBob25lVmFsaWRhdGlvblNlcnZpY2UudmFsaWRhdGVBbmRGb3JtYXQoY29udHJvbC52YWx1ZSwgdGhpcy5zZWxlY3RlZE9wdGlvbi5jb2RlLCB0aGlzLnNlbGVjdGVkT3B0aW9uLmRpYWxfY29kZSk7XHJcbiAgICAgIGlmICh2YWxpZGF0aW9uLm1hc2tlZCA9PT0gY29udHJvbC52YWx1ZSkgcmV0dXJuIG51bGw7XHJcbiAgICAgIHRoaXMubGFiZWxQaG9uZU51bWJlclZhbGlkYXRpb24gPSAnUGhvbmUgbnVtYmVyIGlzIGludmFsaWQnO1xyXG4gICAgICB0aGlzLnBob25lVmFsaWRhdGVkID0gZmFsc2U7XHJcbiAgICAgIHRoaXMudmFsaWRhdGlvblBob25lRXZlbnQuZW1pdChmYWxzZSk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAodGhpcy52ZXJpZmllZFBob25lTnVtYmVyLmxlbmd0aCAmJiBjb250cm9sLnZhbHVlID09PSB0aGlzLnZlcmlmaWVkUGhvbmVOdW1iZXIucmVwbGFjZSgvXFxzfC0vZ2ksICcnKSkge1xyXG4gICAgICAgIHRoaXMudmFsaWRhdGlvblBob25lRXZlbnQuZW1pdCh0cnVlKTtcclxuICAgICAgICB0aGlzLnBob25lVmFsaWRhdGVkID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHZhbGlkYXRpb24uaXNWYWxpZCkge1xyXG4gICAgICAgIGNvbnRyb2wuc2V0VmFsdWUodmFsaWRhdGlvbi5tYXNrZWQgfHwgY29udHJvbC52YWx1ZSk7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgIH1cclxuICAgIFxyXG4gICAgICByZXR1cm4geyBpc0ludmFsaWRQaG9uZU51bWJlcjogdHJ1ZSB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb3B0aW9uczogSUNvdW50cnlbXSA9IFtdO1xyXG4gIHNlbGVjdGVkT3B0aW9uID0gbmV3IENvdW50cnkoKTtcclxuICB2ZXJpZmllZFBob25lTnVtYmVyID0gJyc7XHJcbiAgZm9ybUdyb3VwID0gbmV3IEZvcm1Hcm91cCh7XHJcbiAgICBwaG9uZU51bWJlcjogbmV3IEZvcm1Db250cm9sKCcnLCBbVmFsaWRhdG9ycy5yZXF1aXJlZCwgdGhpcy5pc1ZhbGlkUGhvbmVOdW1iZXIoKV0pXHJcbiAgfSk7XHJcbiAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBwaG9uZVZhbGlkYXRpb25TZXJ2aWNlOiBQaG9uZVZhbGlkYXRpb25TZXJ2aWNlXHJcbiAgKSB7fVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIHRoaXMub3B0aW9ucyA9IGNvdW50cmllc0NvZGUubWFwKGNvdW50cnkgPT4gbmV3IENvdW50cnkoY291bnRyeS5uYW1lLCBjb3VudHJ5LmRpYWxfY29kZSwgY291bnRyeS5jb2RlLCBjb3VudHJ5LmxhdGl0dWRlLCBjb3VudHJ5LmxvbmdpdHVkZSkpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICB0aGlzLmRlc3Ryb3kkLm5leHQoKTtcclxuICAgIHRoaXMuZGVzdHJveSQudW5zdWJzY3JpYmUoKTtcclxuICB9XHJcblxyXG4gIGdldFNlbGVjdGVkQ291bnRyeShjb3VudHJ5OiBJQ291bnRyeSk6IHZvaWQge1xyXG4gICAgdGhpcy5zZWxlY3RlZE9wdGlvbiA9IG5ldyBDb3VudHJ5KGNvdW50cnkubmFtZSwgY291bnRyeS5kaWFsX2NvZGUsIGNvdW50cnkuY29kZSwgY291bnRyeS5sYXRpdHVkZSwgY291bnRyeS5sb25naXR1ZGUpO1xyXG4gICAgdGhpcy5mb3JtR3JvdXAucGF0Y2hWYWx1ZSh7XHJcbiAgICAgIHBob25lTnVtYmVyOiBjb3VudHJ5LmRpYWxfY29kZSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q291bnRyeUJ5UGhvbmVOdW1iZXIocGhvbmVOdW1iZXI6IHN0cmluZykge1xyXG4gICAgY29uc3QgY291bnRyaWVzID0gdGhpcy5waG9uZVZhbGlkYXRpb25TZXJ2aWNlLmZpbHRlckNvdW50cnlDb2RlKHBob25lTnVtYmVyKTtcclxuICAgIGlmKGNvdW50cmllcy5sZW5ndGgpIHRoaXMuY2hlY2tJZkhhc0VxdWFsc0RpYWxDb2RlKGNvdW50cmllcyk7XHJcbiAgfVxyXG5cclxuICBjaGVja0lmSGFzRXF1YWxzRGlhbENvZGUoY291bnRyaWVzOiBJQ291bnRyeVtdKSB7XHJcbiAgICBjb25zdCBoYXNFcXVhbHNEaWFsQ29kZSA9IGNvdW50cmllcy5maW5kKGNvdW50cnkgPT4gY291bnRyeS5kaWFsX2NvZGUgPT09IHRoaXMuc2VsZWN0ZWRPcHRpb24uZGlhbF9jb2RlICYmIGNvdW50cnkubmFtZSA9PT0gdGhpcy5zZWxlY3RlZE9wdGlvbi5uYW1lKTtcclxuICAgIGlmICghaGFzRXF1YWxzRGlhbENvZGUpXHJcbiAgICB0aGlzLnNlbGVjdGVkT3B0aW9uID0gbmV3IENvdW50cnkoY291bnRyaWVzWzBdLm5hbWUsIGNvdW50cmllc1swXS5kaWFsX2NvZGUsIGNvdW50cmllc1swXS5jb2RlLCBjb3VudHJpZXNbMF0ubGF0aXR1ZGUsIGNvdW50cmllc1swXS5sb25naXR1ZGUpO1xyXG4gIH1cclxuXHJcbiAgZ2V0IHBob25lTnVtYmVyKCk6IEZvcm1Db250cm9sIHtcclxuICAgIHJldHVybiB0aGlzLmZvcm1Hcm91cC5jb250cm9scy5waG9uZU51bWJlcjtcclxuICB9XHJcblxyXG59XHJcbiIsIjxmb3JtIFtmb3JtR3JvdXBdPVwiZm9ybUdyb3VwXCIgY2xhc3M9XCJkLWZsZXggZmxleC1jb2x1bW5cIj5cclxuICA8ZGl2IGNsYXNzPVwiZC1mbGV4IGp1c3RpZnktY29udGVudC1iZXR3ZWVuXCI+XHJcbiAgICA8ZGl2IGNsYXNzPVwicm93LWZvcm0gbXQtMCBmbGV4LWdyb3ctMFwiPlxyXG4gICAgICA8Y2RrLWN1c3RvbS1zZWxlY3RcclxuICAgICAgICBwbGFjZWhvbGRlcj1cIlwiXHJcbiAgICAgICAgbW9kZWxQcm9wZXJ0eT1cImRpYWxfY29kZVwiXHJcbiAgICAgICAgbGFiZWw9XCJjb2RlXCJcclxuICAgICAgICBbb3B0aW9uc109XCJvcHRpb25zXCJcclxuICAgICAgICBbc2VsZWN0ZWRPcHRpb25dPVwic2VsZWN0ZWRPcHRpb25cIlxyXG4gICAgICAgIFtpc1ZhbGlkXT1cInBob25lTnVtYmVyICYmIHBob25lTnVtYmVyLnRvdWNoZWQgJiYgIXBob25lTnVtYmVyLmVycm9yc1wiXHJcbiAgICAgICAgKHZhbHVlQ2hhbmdlcyk9XCJnZXRTZWxlY3RlZENvdW50cnkoJGV2ZW50KVwiXHJcbiAgICAgICAgW2hhc0xlZnRJY29uXT1cInRydWVcIlxyXG4gICAgICAgIFtoYXNEaXZpZGVyXT1cInRydWVcIlxyXG4gICAgICAgIGNsYXNzPVwibWUtMyBkLWJsb2NrXCJcclxuICAgICAgPlxyXG4gICAgICAgIDxuZy10ZW1wbGF0ZSAjY3VzdG9tVGVtcGxhdGUgbGV0LWl0ZW0gbGV0LWluZGV4IGxldC1faW5kZXg9XCJpbmRleFwiPlxyXG4gICAgICAgICAgPHNwYW4+XHJcbiAgICAgICAgICAgIDxpIGNsYXNzPVwibWUtMiBmbGFnLWljb24gZmxhZy1pY29uLXt7IGl0ZW0/LmZsYWcgfX1cIj48L2k+XHJcbiAgICAgICAgICAgICh7eyBpdGVtPy5kaWFsX2NvZGUgfX0pIHt7IGl0ZW0/Lm5hbWUgfX1cclxuICAgICAgICAgIDwvc3Bhbj5cclxuXHJcbiAgICAgICAgICA8c3BhbiBhcmlhLWhpZGRlbj1cInRydWVcIiAqbmdJZj1cIl9pbmRleCA9PT0gMVwiIGNsYXNzPVwiZGl2aWRlclwiPjwvc3Bhbj5cclxuICAgICAgICA8L25nLXRlbXBsYXRlPlxyXG5cclxuICAgICAgICA8bmctdGVtcGxhdGUgI3NlbGVjdGVkVGVtcGxhdGUgbGV0LWl0ZW0+XHJcbiAgICAgICAgICA8aSBjbGFzcz1cIm1lLTIgZmxhZy1pY29uIGZsYWctaWNvbi17eyBpdGVtPy5mbGFnIH19XCI+PC9pPlxyXG4gICAgICAgIDwvbmctdGVtcGxhdGU+XHJcbiAgICAgIDwvY2RrLWN1c3RvbS1zZWxlY3Q+XHJcbiAgICA8L2Rpdj5cclxuXHJcbiAgICA8ZGl2IGNsYXNzPVwicm93LWZvcm0gcG9zaXRpb24tcmVsYXRpdmUgZmxleC1ncm93LTEgdy0xMDBcIj5cclxuICAgICAgPGlucHV0XHJcbiAgICAgICAgdHlwZT1cInRleHRcIlxyXG4gICAgICAgIGlkPVwicGhvbmVOdW1iZXJcIlxyXG4gICAgICAgIGZvcm1Db250cm9sTmFtZT1cInBob25lTnVtYmVyXCJcclxuICAgICAgICBjZGtJbnB1dFZhbGlkYXRpb25cclxuICAgICAgICBbY2xhc3MudmFsaWRhdGVkXT1cInBob25lVmFsaWRhdGVkXCJcclxuICAgICAgLz5cclxuICAgICAgPGxhYmVsIGZvcj1cInBob25lTnVtYmVyXCI+UGhvbmUgbnVtYmVyPC9sYWJlbD5cclxuXHJcbiAgICAgIDxzbWFsbCAqbmdJZj1cInBob25lTnVtYmVyICYmIHBob25lTnVtYmVyLnRvdWNoZWQgJiYgcGhvbmVOdW1iZXIuZXJyb3JzXCI+XHJcbiAgICAgICAgPHNwYW4gKm5nSWY9XCJwaG9uZU51bWJlciAmJiBwaG9uZU51bWJlci5lcnJvcnNbJ3JlcXVpcmVkJ11cIj5QaG9uZSBudW1iZXIgaXMgcmVxdWlyZWQ8L3NwYW4+XHJcbiAgICAgICAgPHNwYW4gKm5nSWY9XCJwaG9uZU51bWJlciAmJiBwaG9uZU51bWJlci52YWx1ZS5sZW5ndGggJiYgcGhvbmVOdW1iZXIuZXJyb3JzWydpc0ludmFsaWRQaG9uZU51bWJlciddXCI+e3sgbGFiZWxQaG9uZU51bWJlclZhbGlkYXRpb24gfX08L3NwYW4+XHJcbiAgICAgIDwvc21hbGw+XHJcblxyXG4gICAgICA8c3BhbiBjbGFzcz1cInZhbGlkYXRpb24taWNvblwiPlxyXG4gICAgICAgIDxpIGNsYXNzPVwiYmkgYmktY2hlY2syIGNoZWNrXCIgKm5nSWY9XCJwaG9uZVZhbGlkYXRlZCAmJiBwaG9uZUF2YWlsYWJsZVwiPjwvaT5cclxuICAgICAgICA8aSBjbGFzcz1cImJpIGJpLXgtbGcgZXJyb3JcIiAqbmdJZj1cInBob25lVmFsaWRhdGVkICYmICFwaG9uZUF2YWlsYWJsZVwiPjwvaT5cclxuICAgICAgPC9zcGFuPlxyXG4gICAgPC9kaXY+XHJcbiAgPC9kaXY+XHJcblxyXG4gIDxkaXYgY2xhc3M9XCJkLWZsZXgganVzdGlmeS1jb250ZW50LWVuZCBtdC0zXCI+XHJcbiAgICA8YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiBjbGFzcz1cImJ0biBidG4tZGFya1wiIFtkaXNhYmxlZF09XCIhcGhvbmVOdW1iZXIudmFsdWUubGVuZ3RoIHx8IHBob25lTnVtYmVyLmVycm9yc1wiIFtjZGtMb2FkaW5nQnV0dG9uXT1cImlzTG9hZGluZ1wiICpuZ0lmPVwiIXBob25lVmFsaWRhdGVkIHx8ICFwaG9uZUF2YWlsYWJsZVwiPlxyXG4gICAgICA8Y2RrLXNwaW5uZXI+VmVyaWZ5IFBob25lPC9jZGstc3Bpbm5lcj5cclxuICAgIDwvYnV0dG9uPlxyXG4gICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4gYnRuLW91dGxpbmUtc3VjY2Vzc1wiIGRpc2FibGVkICpuZ0lmPVwicGhvbmVWYWxpZGF0ZWQgJiYgcGhvbmVBdmFpbGFibGVcIj5QaG9uZSBWZXJpZmllZDwvYnV0dG9uPlxyXG4gIDwvZGl2PlxyXG5cclxuPC9mb3JtPlxyXG4iXX0=