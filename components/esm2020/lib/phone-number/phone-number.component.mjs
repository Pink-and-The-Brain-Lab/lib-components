import { Component, EventEmitter, Output } from '@angular/core';
import { FormControl, FormGroup, Validators } from '@angular/forms';
import { Subject } from 'rxjs';
import { countriesCode } from './data/countries-codes';
import { Country } from './model/country.model';
import * as i0 from "@angular/core";
import * as i1 from "./service/phone-validation.service";
import * as i2 from "@angular/common";
import * as i3 from "../custom-select/custom-select.component";
import * as i4 from "@angular/forms";
import * as i5 from "../input-validation/input-validation.directive";
import * as i6 from "../loading-button/loading-button.directive";
import * as i7 from "../spinner/spinner.component";
export class PhoneNumberComponent {
    constructor(phoneValidationService) {
        this.phoneValidationService = phoneValidationService;
        this.validationPhoneEvent = new EventEmitter();
        this.isValidPhoneNumber = () => {
            return (control) => {
                this.getCountryByPhoneNumber(control.value);
                const validation = this.phoneValidationService.validateAndFormat(control.value, this.selectedOption.code, this.selectedOption.dial_code);
                if (validation.masked === control.value)
                    return null;
                this.labelPhoneNumberValidation = 'Phone number is invalid';
                this.phoneValidated = false;
                this.validationPhoneEvent.emit(false);
                if (this.verifiedPhoneNumber.length && control.value === this.verifiedPhoneNumber.replace(/\s|-/gi, '')) {
                    this.validationPhoneEvent.emit(true);
                    this.phoneValidated = true;
                    return null;
                }
                if (validation.isValid) {
                    control.setValue(validation.masked || control.value);
                    return null;
                }
                return { isInvalidPhoneNumber: true };
            };
        };
        this.options = [];
        this.selectedOption = new Country();
        this.phoneValidated = false;
        this.phoneAvailable = false;
        this.isLoading = false;
        this.verifiedPhoneNumber = '';
        this.labelPhoneNumberValidation = 'Phone number is invalid';
        this.formGroup = new FormGroup({
            phoneNumber: new FormControl('', [Validators.required, this.isValidPhoneNumber()])
        });
        this.destroy$ = new Subject();
    }
    ngOnInit() {
        this.options = countriesCode.map(country => new Country(country.name, country.dial_code, country.code, country.latitude, country.longitude));
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.unsubscribe();
    }
    getSelectedCountry(country) {
        this.selectedOption = new Country(country.name, country.dial_code, country.code, country.latitude, country.longitude);
        this.formGroup.patchValue({
            phoneNumber: country.dial_code,
        });
    }
    getCountryByPhoneNumber(phoneNumber) {
        const countries = this.phoneValidationService.filterCountryCode(phoneNumber);
        if (countries.length)
            this.checkIfHasEqualsDialCode(countries);
    }
    checkIfHasEqualsDialCode(countries) {
        const hasEqualsDialCode = countries.find(country => country.dial_code === this.selectedOption.dial_code && country.name === this.selectedOption.name);
        if (!hasEqualsDialCode)
            this.selectedOption = new Country(countries[0].name, countries[0].dial_code, countries[0].code, countries[0].latitude, countries[0].longitude);
    }
    verifyPhoneNumber() {
        this.isLoading = true;
        setTimeout(() => {
            this.isLoading = false;
            this.phoneValidated = true;
            this.phoneAvailable = true;
            this.verifiedPhoneNumber = this.phoneNumber.value;
            this.validationPhoneEvent.emit(this.phoneAvailable);
            // EXEMPLO DE ERRO NA VALIDAÇÃO DO TELEFONE
            // this.phoneAvailable = false;
            // this.labelPhoneNumberValidation = 'Phone number unvailable';
            // this.phoneNumber.setErrors({ isInvalidPhoneNumber: true });
        }, 3000);
    }
    get phoneNumber() {
        return this.formGroup.controls.phoneNumber;
    }
}
PhoneNumberComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "15.1.2", ngImport: i0, type: PhoneNumberComponent, deps: [{ token: i1.PhoneValidationService }], target: i0.ɵɵFactoryTarget.Component });
PhoneNumberComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "15.1.2", type: PhoneNumberComponent, selector: "cdk-phone-number", outputs: { validationPhoneEvent: "validationPhoneEvent" }, ngImport: i0, template: "<form [formGroup]=\"formGroup\" class=\"d-flex flex-column\" (submit)=\"verifyPhoneNumber()\">\r\n  <div class=\"d-flex justify-content-between\">\r\n    <div class=\"row-form mt-0 flex-grow-0\">\r\n      <cdk-custom-select\r\n        placeholder=\"\"\r\n        modelProperty=\"dial_code\"\r\n        label=\"code\"\r\n        [options]=\"options\"\r\n        [selectedOption]=\"selectedOption\"\r\n        [isValid]=\"phoneNumber && phoneNumber.touched && !phoneNumber.errors\"\r\n        (valueChanges)=\"getSelectedCountry($event)\"\r\n        [hasLeftIcon]=\"true\"\r\n        [hasDivider]=\"true\"\r\n        class=\"me-3 d-block\"\r\n      >\r\n        <ng-template #customTemplate let-item let-index let-_index=\"index\">\r\n          <span>\r\n            <i class=\"me-2 flag-icon flag-icon-{{ item?.flag }}\"></i>\r\n            ({{ item?.dial_code }}) {{ item?.name }}\r\n          </span>\r\n\r\n          <span aria-hidden=\"true\" *ngIf=\"_index === 1\" class=\"divider\"></span>\r\n        </ng-template>\r\n\r\n        <ng-template #selectedTemplate let-item>\r\n          <i class=\"me-2 flag-icon flag-icon-{{ item?.flag }}\"></i>\r\n        </ng-template>\r\n      </cdk-custom-select>\r\n    </div>\r\n\r\n    <div class=\"row-form position-relative flex-grow-1 w-100\">\r\n      <input\r\n        type=\"text\"\r\n        id=\"phoneNumber\"\r\n        formControlName=\"phoneNumber\"\r\n        cdkInputValidation\r\n        [class.validated]=\"phoneValidated\"\r\n      />\r\n      <label for=\"phoneNumber\">Phone number</label>\r\n\r\n      <small *ngIf=\"phoneNumber && phoneNumber.touched && phoneNumber.errors\">\r\n        <span *ngIf=\"phoneNumber && phoneNumber.errors['required']\">Phone number is required</span>\r\n        <span *ngIf=\"phoneNumber && phoneNumber.value.length && phoneNumber.errors['isInvalidPhoneNumber']\">{{ labelPhoneNumberValidation }}</span>\r\n      </small>\r\n\r\n      <span class=\"validation-icon\">\r\n        <i class=\"bi bi-check2 check\" *ngIf=\"phoneValidated && phoneAvailable\"></i>\r\n        <i class=\"bi bi-x-lg error\" *ngIf=\"phoneValidated && !phoneAvailable\"></i>\r\n      </span>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"d-flex justify-content-end mt-3\">\r\n    <button type=\"submit\" class=\"btn btn-dark\" [disabled]=\"!phoneNumber.value.length || phoneNumber.errors\" [cdkLoadingButton]=\"isLoading\" *ngIf=\"!phoneValidated || !phoneAvailable\">\r\n      <cdk-spinner>Verify Phone</cdk-spinner>\r\n    </button>\r\n    <button type=\"button\" class=\"btn btn-outline-success\" disabled *ngIf=\"phoneValidated && phoneAvailable\">Phone Verified</button>\r\n  </div>\r\n\r\n</form>\r\n", styles: ["form{width:100%;max-width:500px}form cdk-custom-select{width:90px}form input.validated{padding-right:30px}form .validation-icon{position:absolute;top:11px;right:3px}form .validation-icon .check{color:#00cb5f}form .validation-icon .error{color:#ff5d4f}\n"], dependencies: [{ kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i3.CustomSelectComponent, selector: "cdk-custom-select", inputs: ["options", "placeholder", "modelProperty", "label", "selectedOption", "isValid", "hasLeftIcon", "hasDivider"], outputs: ["valueChanges"] }, { kind: "directive", type: i4.ɵNgNoValidate, selector: "form:not([ngNoForm]):not([ngNativeValidate])" }, { kind: "directive", type: i4.DefaultValueAccessor, selector: "input:not([type=checkbox])[formControlName],textarea[formControlName],input:not([type=checkbox])[formControl],textarea[formControl],input:not([type=checkbox])[ngModel],textarea[ngModel],[ngDefaultControl]" }, { kind: "directive", type: i4.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i4.NgControlStatusGroup, selector: "[formGroupName],[formArrayName],[ngModelGroup],[formGroup],form:not([ngNoForm]),[ngForm]" }, { kind: "directive", type: i4.FormGroupDirective, selector: "[formGroup]", inputs: ["formGroup"], outputs: ["ngSubmit"], exportAs: ["ngForm"] }, { kind: "directive", type: i4.FormControlName, selector: "[formControlName]", inputs: ["formControlName", "disabled", "ngModel"], outputs: ["ngModelChange"] }, { kind: "directive", type: i5.InputValidationDirective, selector: "[cdkInputValidation]" }, { kind: "directive", type: i6.LoadingButtonDirective, selector: "[cdkLoadingButton]", inputs: ["cdkLoadingButton"] }, { kind: "component", type: i7.SpinnerComponent, selector: "cdk-spinner" }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "15.1.2", ngImport: i0, type: PhoneNumberComponent, decorators: [{
            type: Component,
            args: [{ selector: 'cdk-phone-number', template: "<form [formGroup]=\"formGroup\" class=\"d-flex flex-column\" (submit)=\"verifyPhoneNumber()\">\r\n  <div class=\"d-flex justify-content-between\">\r\n    <div class=\"row-form mt-0 flex-grow-0\">\r\n      <cdk-custom-select\r\n        placeholder=\"\"\r\n        modelProperty=\"dial_code\"\r\n        label=\"code\"\r\n        [options]=\"options\"\r\n        [selectedOption]=\"selectedOption\"\r\n        [isValid]=\"phoneNumber && phoneNumber.touched && !phoneNumber.errors\"\r\n        (valueChanges)=\"getSelectedCountry($event)\"\r\n        [hasLeftIcon]=\"true\"\r\n        [hasDivider]=\"true\"\r\n        class=\"me-3 d-block\"\r\n      >\r\n        <ng-template #customTemplate let-item let-index let-_index=\"index\">\r\n          <span>\r\n            <i class=\"me-2 flag-icon flag-icon-{{ item?.flag }}\"></i>\r\n            ({{ item?.dial_code }}) {{ item?.name }}\r\n          </span>\r\n\r\n          <span aria-hidden=\"true\" *ngIf=\"_index === 1\" class=\"divider\"></span>\r\n        </ng-template>\r\n\r\n        <ng-template #selectedTemplate let-item>\r\n          <i class=\"me-2 flag-icon flag-icon-{{ item?.flag }}\"></i>\r\n        </ng-template>\r\n      </cdk-custom-select>\r\n    </div>\r\n\r\n    <div class=\"row-form position-relative flex-grow-1 w-100\">\r\n      <input\r\n        type=\"text\"\r\n        id=\"phoneNumber\"\r\n        formControlName=\"phoneNumber\"\r\n        cdkInputValidation\r\n        [class.validated]=\"phoneValidated\"\r\n      />\r\n      <label for=\"phoneNumber\">Phone number</label>\r\n\r\n      <small *ngIf=\"phoneNumber && phoneNumber.touched && phoneNumber.errors\">\r\n        <span *ngIf=\"phoneNumber && phoneNumber.errors['required']\">Phone number is required</span>\r\n        <span *ngIf=\"phoneNumber && phoneNumber.value.length && phoneNumber.errors['isInvalidPhoneNumber']\">{{ labelPhoneNumberValidation }}</span>\r\n      </small>\r\n\r\n      <span class=\"validation-icon\">\r\n        <i class=\"bi bi-check2 check\" *ngIf=\"phoneValidated && phoneAvailable\"></i>\r\n        <i class=\"bi bi-x-lg error\" *ngIf=\"phoneValidated && !phoneAvailable\"></i>\r\n      </span>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"d-flex justify-content-end mt-3\">\r\n    <button type=\"submit\" class=\"btn btn-dark\" [disabled]=\"!phoneNumber.value.length || phoneNumber.errors\" [cdkLoadingButton]=\"isLoading\" *ngIf=\"!phoneValidated || !phoneAvailable\">\r\n      <cdk-spinner>Verify Phone</cdk-spinner>\r\n    </button>\r\n    <button type=\"button\" class=\"btn btn-outline-success\" disabled *ngIf=\"phoneValidated && phoneAvailable\">Phone Verified</button>\r\n  </div>\r\n\r\n</form>\r\n", styles: ["form{width:100%;max-width:500px}form cdk-custom-select{width:90px}form input.validated{padding-right:30px}form .validation-icon{position:absolute;top:11px;right:3px}form .validation-icon .check{color:#00cb5f}form .validation-icon .error{color:#ff5d4f}\n"] }]
        }], ctorParameters: function () { return [{ type: i1.PhoneValidationService }]; }, propDecorators: { validationPhoneEvent: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGhvbmUtbnVtYmVyLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2NvbXBvbmVudHMvc3JjL2xpYi9waG9uZS1udW1iZXIvcGhvbmUtbnVtYmVyLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2NvbXBvbmVudHMvc3JjL2xpYi9waG9uZS1udW1iZXIvcGhvbmUtbnVtYmVyLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFxQixNQUFNLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDbkYsT0FBTyxFQUFtQixXQUFXLEVBQUUsU0FBUyxFQUFpQyxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNwSCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUV2RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7Ozs7Ozs7OztBQVFoRCxNQUFNLE9BQU8sb0JBQW9CO0lBd0MvQixZQUNVLHNCQUE4QztRQUE5QywyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCO1FBdkM5Qyx5QkFBb0IsR0FBRyxJQUFJLFlBQVksRUFBVyxDQUFDO1FBRTdELHVCQUFrQixHQUFHLEdBQWdCLEVBQUU7WUFDckMsT0FBTyxDQUFDLE9BQXdCLEVBQTJCLEVBQUU7Z0JBQzNELElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQzVDLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7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aUhBMUZVLG9CQUFvQjtxR0FBcEIsb0JBQW9CLG1IQ2JqQyx1bkZBNERBOzJGRC9DYSxvQkFBb0I7a0JBTGhDLFNBQVM7K0JBQ0Usa0JBQWtCOzZHQU1sQixvQkFBb0I7c0JBQTdCLE1BQU0iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgT25EZXN0cm95LCBPbkluaXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIEZvcm1Db250cm9sLCBGb3JtR3JvdXAsIFZhbGlkYXRpb25FcnJvcnMsIFZhbGlkYXRvckZuLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGNvdW50cmllc0NvZGUgfSBmcm9tICcuL2RhdGEvY291bnRyaWVzLWNvZGVzJztcclxuaW1wb3J0IHsgSUNvdW50cnkgfSBmcm9tICcuL21vZGVsL2NvdW50cnkuaW50ZXJmYWNlJztcclxuaW1wb3J0IHsgQ291bnRyeSB9IGZyb20gJy4vbW9kZWwvY291bnRyeS5tb2RlbCc7XHJcbmltcG9ydCB7IFBob25lVmFsaWRhdGlvblNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2UvcGhvbmUtdmFsaWRhdGlvbi5zZXJ2aWNlJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gIHNlbGVjdG9yOiAnY2RrLXBob25lLW51bWJlcicsXHJcbiAgdGVtcGxhdGVVcmw6ICcuL3Bob25lLW51bWJlci5jb21wb25lbnQuaHRtbCcsXHJcbiAgc3R5bGVVcmxzOiBbJy4vcGhvbmUtbnVtYmVyLmNvbXBvbmVudC5zY3NzJ11cclxufSlcclxuZXhwb3J0IGNsYXNzIFBob25lTnVtYmVyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xyXG5cclxuICBAT3V0cHV0KCkgdmFsaWRhdGlvblBob25lRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyPGJvb2xlYW4+KCk7XHJcblxyXG4gIGlzVmFsaWRQaG9uZU51bWJlciA9ICgpOiBWYWxpZGF0b3JGbiA9PiB7XHJcbiAgICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsID0+IHtcclxuICAgICAgdGhpcy5nZXRDb3VudHJ5QnlQaG9uZU51bWJlcihjb250cm9sLnZhbHVlKTtcclxuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMucGhvbmVWYWxpZGF0aW9uU2VydmljZS52YWxpZGF0ZUFuZEZvcm1hdChjb250cm9sLnZhbHVlLCB0aGlzLnNlbGVjdGVkT3B0aW9uLmNvZGUsIHRoaXMuc2VsZWN0ZWRPcHRpb24uZGlhbF9jb2RlKTtcclxuICAgICAgaWYgKHZhbGlkYXRpb24ubWFza2VkID09PSBjb250cm9sLnZhbHVlKSByZXR1cm4gbnVsbDtcclxuICAgICAgdGhpcy5sYWJlbFBob25lTnVtYmVyVmFsaWRhdGlvbiA9ICdQaG9uZSBudW1iZXIgaXMgaW52YWxpZCc7XHJcbiAgICAgIHRoaXMucGhvbmVWYWxpZGF0ZWQgPSBmYWxzZTtcclxuICAgICAgdGhpcy52YWxpZGF0aW9uUGhvbmVFdmVudC5lbWl0KGZhbHNlKTtcclxuICAgICAgXHJcbiAgICAgIGlmICh0aGlzLnZlcmlmaWVkUGhvbmVOdW1iZXIubGVuZ3RoICYmIGNvbnRyb2wudmFsdWUgPT09IHRoaXMudmVyaWZpZWRQaG9uZU51bWJlci5yZXBsYWNlKC9cXHN8LS9naSwgJycpKSB7XHJcbiAgICAgICAgdGhpcy52YWxpZGF0aW9uUGhvbmVFdmVudC5lbWl0KHRydWUpO1xyXG4gICAgICAgIHRoaXMucGhvbmVWYWxpZGF0ZWQgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodmFsaWRhdGlvbi5pc1ZhbGlkKSB7XHJcbiAgICAgICAgY29udHJvbC5zZXRWYWx1ZSh2YWxpZGF0aW9uLm1hc2tlZCB8fCBjb250cm9sLnZhbHVlKTtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIHJldHVybiB7IGlzSW52YWxpZFBob25lTnVtYmVyOiB0cnVlIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBvcHRpb25zOiBJQ291bnRyeVtdID0gW107XHJcbiAgc2VsZWN0ZWRPcHRpb24gPSBuZXcgQ291bnRyeSgpO1xyXG4gIHBob25lVmFsaWRhdGVkID0gZmFsc2U7XHJcbiAgcGhvbmVBdmFpbGFibGUgPSBmYWxzZTtcclxuICBpc0xvYWRpbmcgPSBmYWxzZTtcclxuICB2ZXJpZmllZFBob25lTnVtYmVyID0gJyc7XHJcbiAgbGFiZWxQaG9uZU51bWJlclZhbGlkYXRpb24gPSAnUGhvbmUgbnVtYmVyIGlzIGludmFsaWQnO1xyXG4gIGZvcm1Hcm91cCA9IG5ldyBGb3JtR3JvdXAoe1xyXG4gICAgcGhvbmVOdW1iZXI6IG5ldyBGb3JtQ29udHJvbCgnJywgW1ZhbGlkYXRvcnMucmVxdWlyZWQsIHRoaXMuaXNWYWxpZFBob25lTnVtYmVyKCldKVxyXG4gIH0pO1xyXG4gIHByaXZhdGUgZGVzdHJveSQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xyXG5cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgcGhvbmVWYWxpZGF0aW9uU2VydmljZTogUGhvbmVWYWxpZGF0aW9uU2VydmljZVxyXG4gICkge31cclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICB0aGlzLm9wdGlvbnMgPSBjb3VudHJpZXNDb2RlLm1hcChjb3VudHJ5ID0+IG5ldyBDb3VudHJ5KGNvdW50cnkubmFtZSwgY291bnRyeS5kaWFsX2NvZGUsIGNvdW50cnkuY29kZSwgY291bnRyeS5sYXRpdHVkZSwgY291bnRyeS5sb25naXR1ZGUpKTtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgdGhpcy5kZXN0cm95JC5uZXh0KCk7XHJcbiAgICB0aGlzLmRlc3Ryb3kkLnVuc3Vic2NyaWJlKCk7XHJcbiAgfVxyXG5cclxuICBnZXRTZWxlY3RlZENvdW50cnkoY291bnRyeTogSUNvdW50cnkpOiB2b2lkIHtcclxuICAgIHRoaXMuc2VsZWN0ZWRPcHRpb24gPSBuZXcgQ291bnRyeShjb3VudHJ5Lm5hbWUsIGNvdW50cnkuZGlhbF9jb2RlLCBjb3VudHJ5LmNvZGUsIGNvdW50cnkubGF0aXR1ZGUsIGNvdW50cnkubG9uZ2l0dWRlKTtcclxuICAgIHRoaXMuZm9ybUdyb3VwLnBhdGNoVmFsdWUoe1xyXG4gICAgICBwaG9uZU51bWJlcjogY291bnRyeS5kaWFsX2NvZGUsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldENvdW50cnlCeVBob25lTnVtYmVyKHBob25lTnVtYmVyOiBzdHJpbmcpIHtcclxuICAgIGNvbnN0IGNvdW50cmllcyA9IHRoaXMucGhvbmVWYWxpZGF0aW9uU2VydmljZS5maWx0ZXJDb3VudHJ5Q29kZShwaG9uZU51bWJlcik7XHJcbiAgICBpZihjb3VudHJpZXMubGVuZ3RoKSB0aGlzLmNoZWNrSWZIYXNFcXVhbHNEaWFsQ29kZShjb3VudHJpZXMpO1xyXG4gIH1cclxuXHJcbiAgY2hlY2tJZkhhc0VxdWFsc0RpYWxDb2RlKGNvdW50cmllczogSUNvdW50cnlbXSkge1xyXG4gICAgY29uc3QgaGFzRXF1YWxzRGlhbENvZGUgPSBjb3VudHJpZXMuZmluZChjb3VudHJ5ID0+IGNvdW50cnkuZGlhbF9jb2RlID09PSB0aGlzLnNlbGVjdGVkT3B0aW9uLmRpYWxfY29kZSAmJiBjb3VudHJ5Lm5hbWUgPT09IHRoaXMuc2VsZWN0ZWRPcHRpb24ubmFtZSk7XHJcbiAgICBpZiAoIWhhc0VxdWFsc0RpYWxDb2RlKVxyXG4gICAgdGhpcy5zZWxlY3RlZE9wdGlvbiA9IG5ldyBDb3VudHJ5KGNvdW50cmllc1swXS5uYW1lLCBjb3VudHJpZXNbMF0uZGlhbF9jb2RlLCBjb3VudHJpZXNbMF0uY29kZSwgY291bnRyaWVzWzBdLmxhdGl0dWRlLCBjb3VudHJpZXNbMF0ubG9uZ2l0dWRlKTtcclxuICB9XHJcblxyXG4gIHZlcmlmeVBob25lTnVtYmVyKCkge1xyXG4gICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICB0aGlzLnBob25lVmFsaWRhdGVkID0gdHJ1ZTtcclxuICAgICAgdGhpcy5waG9uZUF2YWlsYWJsZSA9IHRydWU7XHJcbiAgICAgIHRoaXMudmVyaWZpZWRQaG9uZU51bWJlciA9IHRoaXMucGhvbmVOdW1iZXIudmFsdWU7XHJcbiAgICAgIHRoaXMudmFsaWRhdGlvblBob25lRXZlbnQuZW1pdCh0aGlzLnBob25lQXZhaWxhYmxlKTtcclxuXHJcbiAgICAgIC8vIEVYRU1QTE8gREUgRVJSTyBOQSBWQUxJREHDh8ODTyBETyBURUxFRk9ORVxyXG4gICAgICAvLyB0aGlzLnBob25lQXZhaWxhYmxlID0gZmFsc2U7XHJcbiAgICAgIC8vIHRoaXMubGFiZWxQaG9uZU51bWJlclZhbGlkYXRpb24gPSAnUGhvbmUgbnVtYmVyIHVudmFpbGFibGUnO1xyXG4gICAgICAvLyB0aGlzLnBob25lTnVtYmVyLnNldEVycm9ycyh7IGlzSW52YWxpZFBob25lTnVtYmVyOiB0cnVlIH0pO1xyXG4gICAgfSwgMzAwMCk7XHJcbiAgfVxyXG5cclxuICBnZXQgcGhvbmVOdW1iZXIoKTogRm9ybUNvbnRyb2wge1xyXG4gICAgcmV0dXJuIHRoaXMuZm9ybUdyb3VwLmNvbnRyb2xzLnBob25lTnVtYmVyO1xyXG4gIH1cclxuXHJcbn1cclxuIiwiPGZvcm0gW2Zvcm1Hcm91cF09XCJmb3JtR3JvdXBcIiBjbGFzcz1cImQtZmxleCBmbGV4LWNvbHVtblwiIChzdWJtaXQpPVwidmVyaWZ5UGhvbmVOdW1iZXIoKVwiPlxyXG4gIDxkaXYgY2xhc3M9XCJkLWZsZXgganVzdGlmeS1jb250ZW50LWJldHdlZW5cIj5cclxuICAgIDxkaXYgY2xhc3M9XCJyb3ctZm9ybSBtdC0wIGZsZXgtZ3Jvdy0wXCI+XHJcbiAgICAgIDxjZGstY3VzdG9tLXNlbGVjdFxyXG4gICAgICAgIHBsYWNlaG9sZGVyPVwiXCJcclxuICAgICAgICBtb2RlbFByb3BlcnR5PVwiZGlhbF9jb2RlXCJcclxuICAgICAgICBsYWJlbD1cImNvZGVcIlxyXG4gICAgICAgIFtvcHRpb25zXT1cIm9wdGlvbnNcIlxyXG4gICAgICAgIFtzZWxlY3RlZE9wdGlvbl09XCJzZWxlY3RlZE9wdGlvblwiXHJcbiAgICAgICAgW2lzVmFsaWRdPVwicGhvbmVOdW1iZXIgJiYgcGhvbmVOdW1iZXIudG91Y2hlZCAmJiAhcGhvbmVOdW1iZXIuZXJyb3JzXCJcclxuICAgICAgICAodmFsdWVDaGFuZ2VzKT1cImdldFNlbGVjdGVkQ291bnRyeSgkZXZlbnQpXCJcclxuICAgICAgICBbaGFzTGVmdEljb25dPVwidHJ1ZVwiXHJcbiAgICAgICAgW2hhc0RpdmlkZXJdPVwidHJ1ZVwiXHJcbiAgICAgICAgY2xhc3M9XCJtZS0zIGQtYmxvY2tcIlxyXG4gICAgICA+XHJcbiAgICAgICAgPG5nLXRlbXBsYXRlICNjdXN0b21UZW1wbGF0ZSBsZXQtaXRlbSBsZXQtaW5kZXggbGV0LV9pbmRleD1cImluZGV4XCI+XHJcbiAgICAgICAgICA8c3Bhbj5cclxuICAgICAgICAgICAgPGkgY2xhc3M9XCJtZS0yIGZsYWctaWNvbiBmbGFnLWljb24te3sgaXRlbT8uZmxhZyB9fVwiPjwvaT5cclxuICAgICAgICAgICAgKHt7IGl0ZW0/LmRpYWxfY29kZSB9fSkge3sgaXRlbT8ubmFtZSB9fVxyXG4gICAgICAgICAgPC9zcGFuPlxyXG5cclxuICAgICAgICAgIDxzcGFuIGFyaWEtaGlkZGVuPVwidHJ1ZVwiICpuZ0lmPVwiX2luZGV4ID09PSAxXCIgY2xhc3M9XCJkaXZpZGVyXCI+PC9zcGFuPlxyXG4gICAgICAgIDwvbmctdGVtcGxhdGU+XHJcblxyXG4gICAgICAgIDxuZy10ZW1wbGF0ZSAjc2VsZWN0ZWRUZW1wbGF0ZSBsZXQtaXRlbT5cclxuICAgICAgICAgIDxpIGNsYXNzPVwibWUtMiBmbGFnLWljb24gZmxhZy1pY29uLXt7IGl0ZW0/LmZsYWcgfX1cIj48L2k+XHJcbiAgICAgICAgPC9uZy10ZW1wbGF0ZT5cclxuICAgICAgPC9jZGstY3VzdG9tLXNlbGVjdD5cclxuICAgIDwvZGl2PlxyXG5cclxuICAgIDxkaXYgY2xhc3M9XCJyb3ctZm9ybSBwb3NpdGlvbi1yZWxhdGl2ZSBmbGV4LWdyb3ctMSB3LTEwMFwiPlxyXG4gICAgICA8aW5wdXRcclxuICAgICAgICB0eXBlPVwidGV4dFwiXHJcbiAgICAgICAgaWQ9XCJwaG9uZU51bWJlclwiXHJcbiAgICAgICAgZm9ybUNvbnRyb2xOYW1lPVwicGhvbmVOdW1iZXJcIlxyXG4gICAgICAgIGNka0lucHV0VmFsaWRhdGlvblxyXG4gICAgICAgIFtjbGFzcy52YWxpZGF0ZWRdPVwicGhvbmVWYWxpZGF0ZWRcIlxyXG4gICAgICAvPlxyXG4gICAgICA8bGFiZWwgZm9yPVwicGhvbmVOdW1iZXJcIj5QaG9uZSBudW1iZXI8L2xhYmVsPlxyXG5cclxuICAgICAgPHNtYWxsICpuZ0lmPVwicGhvbmVOdW1iZXIgJiYgcGhvbmVOdW1iZXIudG91Y2hlZCAmJiBwaG9uZU51bWJlci5lcnJvcnNcIj5cclxuICAgICAgICA8c3BhbiAqbmdJZj1cInBob25lTnVtYmVyICYmIHBob25lTnVtYmVyLmVycm9yc1sncmVxdWlyZWQnXVwiPlBob25lIG51bWJlciBpcyByZXF1aXJlZDwvc3Bhbj5cclxuICAgICAgICA8c3BhbiAqbmdJZj1cInBob25lTnVtYmVyICYmIHBob25lTnVtYmVyLnZhbHVlLmxlbmd0aCAmJiBwaG9uZU51bWJlci5lcnJvcnNbJ2lzSW52YWxpZFBob25lTnVtYmVyJ11cIj57eyBsYWJlbFBob25lTnVtYmVyVmFsaWRhdGlvbiB9fTwvc3Bhbj5cclxuICAgICAgPC9zbWFsbD5cclxuXHJcbiAgICAgIDxzcGFuIGNsYXNzPVwidmFsaWRhdGlvbi1pY29uXCI+XHJcbiAgICAgICAgPGkgY2xhc3M9XCJiaSBiaS1jaGVjazIgY2hlY2tcIiAqbmdJZj1cInBob25lVmFsaWRhdGVkICYmIHBob25lQXZhaWxhYmxlXCI+PC9pPlxyXG4gICAgICAgIDxpIGNsYXNzPVwiYmkgYmkteC1sZyBlcnJvclwiICpuZ0lmPVwicGhvbmVWYWxpZGF0ZWQgJiYgIXBob25lQXZhaWxhYmxlXCI+PC9pPlxyXG4gICAgICA8L3NwYW4+XHJcbiAgICA8L2Rpdj5cclxuICA8L2Rpdj5cclxuXHJcbiAgPGRpdiBjbGFzcz1cImQtZmxleCBqdXN0aWZ5LWNvbnRlbnQtZW5kIG10LTNcIj5cclxuICAgIDxidXR0b24gdHlwZT1cInN1Ym1pdFwiIGNsYXNzPVwiYnRuIGJ0bi1kYXJrXCIgW2Rpc2FibGVkXT1cIiFwaG9uZU51bWJlci52YWx1ZS5sZW5ndGggfHwgcGhvbmVOdW1iZXIuZXJyb3JzXCIgW2Nka0xvYWRpbmdCdXR0b25dPVwiaXNMb2FkaW5nXCIgKm5nSWY9XCIhcGhvbmVWYWxpZGF0ZWQgfHwgIXBob25lQXZhaWxhYmxlXCI+XHJcbiAgICAgIDxjZGstc3Bpbm5lcj5WZXJpZnkgUGhvbmU8L2Nkay1zcGlubmVyPlxyXG4gICAgPC9idXR0b24+XHJcbiAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4tb3V0bGluZS1zdWNjZXNzXCIgZGlzYWJsZWQgKm5nSWY9XCJwaG9uZVZhbGlkYXRlZCAmJiBwaG9uZUF2YWlsYWJsZVwiPlBob25lIFZlcmlmaWVkPC9idXR0b24+XHJcbiAgPC9kaXY+XHJcblxyXG48L2Zvcm0+XHJcbiJdfQ==